const dotenv = require('dotenv');
const moment = require('moment');
const Sentry = require("@sentry/serverless");

// Add comment..

dotenv.config({ path: require('path').resolve(__dirname, '.env') });

if (process.env.SENTRY_DSN !== undefined) {
  Sentry.AWSLambda.init({
    dsn: process.env.SENTRY_DSN,
    tracesSampleRate: 1.0,
    release: 'v1.0.18'
  });
}

let elasticAPM;

if (process.env.ELASTIC_APM_SECRET_TOKEN !== undefined && process.env.ELASTIC_APM_LAMBDA_APM_SERVER !== undefined) {
  console.log('LOG ESASS DATA', process.env.ELASTIC_APM_LAMBDA_APM_SERVER);
  elasticAPM = require('elastic-apm-node').start({
    serviceName: 'poc--release-management-test-dg-hpg',
    secretToken: process.env.ELASTIC_APM_SECRET_TOKEN,
    serverUrl: process.env.ELASTIC_APM_LAMBDA_APM_SERVER,
    environment: 'rm-esaas-aws-dev',
  });
}

const APM = {
  captureError: (error) => {
    if (elasticAPM !== undefined) {
      try {
        elasticAPM.captureError(error);
      } catch (error) {
        console.log('ERROR CAPTURE ERROR', error);
      }
    } else {
      console.error(error);
    }
  }
};

module.exports = {
  moment,
  Sentry,
  APM
};
